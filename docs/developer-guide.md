# Setting up development environment
## Prerequisites
Make sure you have Go installed and correctly configured `$GOPATH`.
The output should look similar to:
```bash
$ go version
go version go1.9.2 darwin/amd64
$ echo "$GOPATH"
/Users/username/Documents/Go
```

## Clone the project
All projects in Go must exist in the `$GOPATH`
```bash
mkdir -p "$GOPATH/src/github.com/grtl" && cd $_
git clone git@github.com:grtl/mysql-operator.git
# Replace with https://github.com/grtl/mysql-operator for https
```

## Install _dep_
Install the lastest version via Homebrew (MacOS):
```bash
brew install dep
```
or check out https://github.com/golang/dep.

## Install _go-bindata_
To modify artifacts files you'll need a copy of `go-bindata` binary.
```sh
go get -u github.com/jteeuwen/go-bindata/...
```

## Install new dependencies
All dependencies are already stored in vendor folder of the repository.

For further development - to install all new dependencies:
```bash
dep ensure
```

You're ready to rock!

## Useful hooks
To avoid common mistakes it's recommended to add simple checks to your
pre-commit hooks. You can use `hack/install-hooks.sh` or paste the following
lines to `.git/hooks/pre-commit`. The provided hook runs:

* `go fmt` to check if modified Go files are correctly formatted
* `go vet` to check for suspicious constructs in the modified Go files
* `hack/verify-codegen.sh` to check if the auto-generated _pkg/*_ files are
  up to date
* `hack/verify-artifacts.sh` to check if the auto-generated _artifacts/*_ files
  (requires [go-bindata](#install-go-bindata))

```bash
#!/bin/bash

echo >&2 "Running pre-commit hooks"

function fmt_error() {
	echo >&2 "Go files must be formatted with gofmt. Please run:"
	for fn in $unformatted; do
	    echo >&2 "  gofmt -w $PWD/$fn"
	done
	exit 1
}

function vet_error() {
	echo >&2 "Go files must pass the go vet checks. Please run:"
	echo >&2 "  go vet $(go list ./... | grep -v '/pkg/client/')"
	echo >&2 "and fix the errors"
	exit 2
}

function codegen_error() {
	echo >&2 "Generated code is out of date. Please run hack/update-codegen.sh"
	exit 3
}

function artifacts_error() {
	echo >&2 "Generated code is out of date. Please run hack/update-artifacts.sh"
	exit 4
}

gofiles=$(git diff --cached --name-only --diff-filter=ACM | grep '\.go$')
artifacts=$(git diff --cached --name-only --diff-filter=ACM | grep 'artifacts/.*\.yaml$')

if [ -z "$gofiles" ]; then
	echo >&2 "Skiped fmt, vet, codegen checks, no *.go files were modified"
else
	echo >&2 " - Checking go fmt"
	unformatted=$(gofmt -l $gofiles)
	[ -z "$unformatted" ] || fmt_error

	echo >&2 " - Checking go vet"
	unvet=$(go vet $(go list ./... | grep -v '/pkg/client/'))
	[ -z "$unvet" ] || vet_error

	echo >&2 " - Checking codegen"
	./hack/verify-codegen.sh > /dev/null || codegen_error
fi

if [ -z "$artifacts" ]; then
	echo >&2 "Skiped artifacts checks, no *.go files were modified"
else
	echo >&2 " - Checking artifacts"
	./hack/verify-artifacts.sh > /dev/null || artifacts_error
fi

```

# Autogenerated code

## Regenerating _pkg/client_
The source files under _pkg/client_ are auto generated. Every time you modify
a file inside _pkg/apis_ they need to be regenerated via:
```bash
./hack/update-codegen.sh
```

## Rgenerating _artifacts_
All artifacts files are compiled into the binary. Every time you modify
a file inside _artifacts_ directory you have to run:
```bash
./hack/update-artifacts.sh
```
